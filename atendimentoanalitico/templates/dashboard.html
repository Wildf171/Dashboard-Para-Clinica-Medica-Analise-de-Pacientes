<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Médico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f0f2f5; }
        .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: none; }
        .card-header { 
            background-color: white; 
            border-bottom: 1px solid #e9ecef; 
            font-weight: bold; 
            color: #495057;
            display: flex;
            justify-content: space-between; 
            align-items: center;
        }
        .kpi-value { font-size: 2rem; font-weight: bold; }
        canvas { max-height: 300px; }
    </style>
</head>
<body>
    <p>Analise de Janeiro a Outubro de 2025</p>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-center">Dashboard de Gestão</h2>
        <a href="/download/geral" class="btn btn-dark">
            <i class="bi bi-file-earmark-spreadsheet"></i> Baixar Base Completa
        </a>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-primary text-white text-center p-3">
                <div>Total de Exames</div>
                <div class="kpi-value">{{ dados.kpis.total_exames }}</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-success text-white text-center p-3">
                <div>Faturamento Total</div>
                <div class="kpi-value">{{ dados.kpis.faturamento }}</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Origem do Paciente</div>
                <div class="card-body">
                    <canvas id="chartOrigem"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Prioridade</div>
                <div class="card-body">
                    <canvas id="chartPrioridade"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    Top 10 Médicos
                    <a href="/download/medicos" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-download"></i> CSV
                    </a>
                </div>
                <div class="card-body">
                    <canvas id="chartMedicos"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    Top 10 Exames
                    <a href="/download/exames" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-download"></i> CSV
                    </a>
                </div>
                <div class="card-body">
                    <canvas id="chartExames"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    Top 10 Diagnósticos (CID)
                    <a href="/download/cids" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-download"></i> CSV
                    </a>
                </div>
                <div class="card-body">
                    <canvas id="chartCIDs"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Evolução Mensal</div>
                <div class="card-body">
                    <canvas id="chartTimeline"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const dados = {{ dados | tojson }};

    new Chart(document.getElementById('chartMedicos'), {
        type: 'bar',
        data: {
            labels: dados.medicos.labels,
            datasets: [{
                label: 'Exames',
                data: dados.medicos.values,
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: { indexAxis: 'y', responsive: true }
    });

    new Chart(document.getElementById('chartExames'), {
        type: 'bar',
        data: {
            labels: dados.exames.labels,
            datasets: [{
                label: 'Qtd',
                data: dados.exames.values,
                backgroundColor: 'rgba(153, 102, 255, 0.7)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: { indexAxis: 'y', responsive: true }
    });

    new Chart(document.getElementById('chartOrigem'), {
        type: 'pie',
        data: {
            labels: dados.origem.labels,
            datasets: [{
                data: dados.origem.values,
                backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0']
            }]
        }
    });

    new Chart(document.getElementById('chartPrioridade'), {
        type: 'doughnut',
        data: {
            labels: dados.prioridade.labels,
            datasets: [{
                data: dados.prioridade.values,
                backgroundColor: ['#FF9F40', '#9966FF', '#C9CBCF']
            }]
        }
    });

    new Chart(document.getElementById('chartCIDs'), {
        type: 'bar',
        data: {
            labels: dados.cids.labels,
            datasets: [{
                label: 'Ocorrências',
                data: dados.cids.values,
                backgroundColor: 'rgba(255, 99, 132, 0.7)'
            }]
        },
        options: { indexAxis: 'y', responsive: true }
    });

    new Chart(document.getElementById('chartTimeline'), {
        type: 'line',
        data: {
            labels: dados.timeline.labels,
            datasets: [{
                label: 'Exames',
                data: dados.timeline.values,
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                fill: true,
                tension: 0.4
            }]
        }
    });
</script>
</body>
</html>